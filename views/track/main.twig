{% extends 'base.twig' %}

{% block css %}
<link href="style/flex.css" rel="stylesheet" />
<style type="text/css">
#time {
	font-size:70px;
}
#resume_btn {
	margin-bottom: 5px;
}
ul.left, ul.left li, ul.left li a {
	height:100%;
}
</style>
{% endblock %}

{% block left_nav %}
<ul class="left">
	<li><a href="{{back}}" class="nav-item"><i class="material-icons">arrow_back</i></a></li>
</ul>
{% endblock %}

{% block content %}
<div class="row">
	{# <div class="col s12">
		<div class="card">
			<div class="card-content">
				<div class="input-field">
					<label for=""></label>
					<select id="search" class="browser-default">
					</select>
				</div>
			</div>
		</div>
	</div> #}
	<div class="col s12">
		<div class="card">
			<div class="card-content">
				<span class="card-title black-text">Exercise</span>
				<div class="row">
					<div class="col s4 center">{{exercise.name}}</div>
					<div class="col s4 center">{{exercise.quant}}</div>
					<div class="col s4 center">{{exercise.step}}</div>
				</div>
			</div>
		</div>
	</div>

	<div class="col s12">
		<div class="card">
			<div class="card-content" id="tracker">
				<div id="time" class="flex-row justify-center align-center">
					0:00 s
				</div>

				<!-- flex-row justify-center align-center -->
				<div id="toggle" class="row">
					<button id="go_btn" class="col s12 waves-effect waves-light btn-large green lighten-1">
						Start
						<i class="material-icons right">play_arrow</i>
					</button>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="modal" class="modal">
	<div class="modal-content">
		<h4>Modal Header</h4>
		<p>A bunch of text</p>
	</div>
	<div class="modal-footer">
		<a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
	</div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="js/element.js"></script>
<script type="text/javascript">
	var root_ele = document.getElementById("tracker");
	var track = {{track|raw}};
	var timer_handle;

	var timer_callback = function(){
		track.time += 1;
		render_time(document.getElementById('time'), track.time);
		timer_handle = window.setTimeout(timer_callback, 1000);
	}

	function padLeftZeroes(nr, n){
		return Array(n-String(nr).length+1).join('0')+nr;
	}

	var render_time = function(ele, time){
		while(ele.firstChild){
			ele.removeChild(ele.firstChild);
		}
		ele.appendChild(text(Math.floor(time / 60) + ":" + padLeftZeroes(time % 60, 2) + " s"));
	}

	var render_button = function(ele, started){
		while(ele.firstChild){
			ele.removeChild(ele.firstChild);
		}
		if(started){
			ele.appendChild(element("button", {'id':'stop_btn', 'class':'col s12 waves-effect waves-light btn-large red lighten-1'}, [
				element('i', {'class':'material-icons right'}, [text('stop')]),
				text('Stop')
			]));
			$("#stop_btn").on('click', function(event){
				window.clearTimeout(timer_handle);
				render_button(ele, !started);
			})
		} else {
			ele.appendChild(element('button', {'id':'resume_btn', 'class':'col s12 waves-effect waves-light btn-large green lighten-1'}, [
				element('i', {'class':'material-icons right'}, [text('play_arrow')]),
				text('Resume')
			]));
			ele.appendChild(element('button', {'id':'finish_btn', 'class':'col s12 waves-effect waves-light btn-large red lighten-1'}, [
				element('i', {'class':'material-icons right'}, [text('done')]),
				text('Finish')
			]));
			$('#resume_btn').on('click', function(event){
				timer_handle = window.setTimeout(timer_callback, 1000);
				render_button(ele, !started);
			});
			$('#finish_btn').on('click', function(event){
				if(timer_handle)
					window.clearTimeout(timer_handle);
				window.location = "{{next}}";
			});
		}
	}

	var render = function(data){
		render_time(document.getElementById('time'), data.time);
		render_button(document.getElementById('toggle'), data.started);
	}
	$("#go_btn").on('click', function(event){
		timer_handle = window.setTimeout(timer_callback, 1000);
		track.started = !track.started;
		render(track);
	});
	
</script>
{% endblock %}